<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Upload Resume</title>
</head>
<body>
  <label for="resumeForm">Resume Form</label>
  <form id="resumeForm"
    style="
      display: flex;
      flex-direction: column;
      align-items: left;
      justify-content: left;
      gap: 0.5rem;
    "
  >
    <label for="resume">Upload Your CV</label>
    <input type="file" name="resume" id="resume" accept="application/pdf,application/vnd.ms-excel"/>
    <button type="submit"
          style="
        width: fit-content;
      "
    >Upload Resume</button>
  </form>
  <br/>
  <br/>

  <label for="projectForm">Project Form</label>
  <form id="projectForm"     style="
      display: flex;
      flex-direction: column;
      align-items: left;
      justify-content: left;
      gap: 0.5rem;
    ">
    <label for="project-header">Project's Header</label>
    <input type="text" name="projectHeader" id="project-header" />
    <label for="project-image">Upload Project's Image</label>
    <input type="file" name="projectImage" id="project-image" accept="image/png, image/gif, image/jpeg" />

    <label for="project-description">Project's Description</label>
    <input type="text" name="projectDescription" id="project-description" >
    <label for="project-href">Project's Href</label>
    <input type="text" name="projectHref" id="project-href" >

    <label for="project-type">Select Project Type</label>
    <select name="projectType" id="project-type" >
      <option value="php">php</option>
      <option value="reactprojects">reactprojects</option>
      <option value="projects">projects</option>
      <option value="node">node</option>
      <option value="excelpowerpoint">excelpowerpoint</option>
      <option value="angular">angular</option>
    </select>
    <label for="project-linkType">Select Project's LinkType</label>

    <select name="projectLinkType" id="project-linkType" >
      <option value="newtab">newtab</option>
      <option value="params">params</option>
      <option value="internal">internal</option>
      <option value="html">html</option>
    </select>
    <button type="submit"
      style="
        width: fit-content;
      "
    >Upload Project</button>
  </form>

  <script>
      document.getElementById("resumeForm").addEventListener("submit",    async function (e) {
        
        e.preventDefault();

        const formData = new FormData();
        const fileInput = document.getElementById("resume");

        if (fileInput.files.length === 0) {
          alert("Please select a file first.");
          return;
        }

        formData.append("resume", fileInput.files[0]);

        try {
          const response = await fetch("http://localhost:3000/upload/resume", {
            method: "PUT",
            body: formData,
  /*           credentials: "include"  */// this is equivalent to withCredentials: true
          });

          if (response.ok) {
            alert("Upload successful!");
          } else {
            alert("Upload failed: " + response.statusText);
          }
        } catch (error) {
          console.error("Error:", error);
          alert("An error occurred.");
        }
      });
      
      const projectForm = document.getElementById("projectForm").addEventListener('submit', async function (e) {
        e.preventDefault()


        const inputArray = Array.from(e.target)

        async function postProject(inputArray) {
            const projectFormData = new FormData();
            inputArray.forEach((input) => {

              if (input.tagName !== 'LABEL' && input.tagName !== 'BUTTON') {
  
                if (input.name === 'projectImage') {
                  projectFormData.append(input.name, input.files[0])
                  console.log(projectFormData.get('projectImage'))
                } else {
                  projectFormData.append(input.name, input.value)

                }
              }
            })

   
 
            const response = await fetch("http://localhost:3000/upload/project", {
              method: "POST",
              body: projectFormData
            }) 

            return response;
        }

        const response = await postProject(inputArray)

        if (response.ok) {
          alert('Project uploaded')
        } else {
          alert('Attention! Project not uploaded!')
        }
      });

  </script>
</body>
</html>
